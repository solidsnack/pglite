#!/bin/bash
set -o errexit -o nounset -o pipefail
function usage {
cat <<USAGE
 USAGE: ...database-path.../stop <pg_ctl-arguments>*

  Stop the database server, if running. Any arguments are passed directly to
  \`pg_ctl\`. For example:

    -w

  to wait for shutdown. If no arguments are passed, the default set is:

    ${default_arguments[@]}

  Postgres supports a "smart" shutdown method, with \`-m smart\`, that causes
  the server to stop only after all clients have disconnected. This can be
  useful.

USAGE
}

default_arguments=( -w -m fast )

function stop {
  local code=0

  if ./status --is-running
  then
    log 'Shutting down server...'
    rm -rf "$tmp" "$self"/info/var/*
    ctl stop "${@:-${default_arguments[@]}}"
  else
    log 'Server not running.'
  fi
}

source "$(dirname "$0")"/main
main "$@"
