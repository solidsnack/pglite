#!/bin/bash
set -o errexit -o nounset -o pipefail
function usage {
cat <<USAGE
 USAGE: ...database-path.../sql <psql-arguments>
        ...database-path.../sql --admin <psql-arguments>

  Connect to the database server, starting it if necessary. Any arguments are
  passed directly to \`psql\`.

  If the first argument (and only the first argument) is \`admin\`, then the
  connection will be made as the database administrator.

USAGE
}

function sql {
  trap ./stop EXIT
  ./start

  if [[ ${1:-} != --admin ]]
  then
    exec psql "$(substitute {db})" "$@"
  else
    shift
    exec psql "$(substitute {admin})" "$@"
  fi
}

source "$(dirname "$0")"/main
main "$@"
